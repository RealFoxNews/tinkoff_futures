'use strict';const _0x190f77=_0x430c;(function(_0x4be402,_0x1e48f7){const _0x3482b3=_0x430c,_0x3802fe=_0x4be402();while(!![]){try{const _0x556ec2=-parseInt(_0x3482b3(0x157))/0x1*(-parseInt(_0x3482b3(0x11f))/0x2)+parseInt(_0x3482b3(0x15c))/0x3*(-parseInt(_0x3482b3(0x13a))/0x4)+-parseInt(_0x3482b3(0x126))/0x5*(-parseInt(_0x3482b3(0x165))/0x6)+parseInt(_0x3482b3(0x137))/0x7*(-parseInt(_0x3482b3(0x149))/0x8)+-parseInt(_0x3482b3(0x148))/0x9+parseInt(_0x3482b3(0x13b))/0xa*(parseInt(_0x3482b3(0x132))/0xb)+-parseInt(_0x3482b3(0xf3))/0xc;if(_0x556ec2===_0x1e48f7)break;else _0x3802fe['push'](_0x3802fe['shift']());}catch(_0xc94b81){_0x3802fe['push'](_0x3802fe['shift']());}}}(_0x3436,0xc6d86));Object[_0x190f77(0x14b)](exports,_0x190f77(0x10d),{'value':!![]}),exports['DropShares']=void 0x0;function _0x430c(_0x468b53,_0x3bdcc9){const _0x34365b=_0x3436();return _0x430c=function(_0x430c82,_0x30a977){_0x430c82=_0x430c82-0xf0;let _0x502ffc=_0x34365b[_0x430c82];return _0x502ffc;},_0x430c(_0x468b53,_0x3bdcc9);}const moment=require(_0x190f77(0xfa)),rxjs_1=require(_0x190f77(0x11d)),tinkoff_invest_api_1=require('tinkoff-invest-api'),instruments_1=require(_0x190f77(0x152)),marketdata_1=require(_0x190f77(0x121)),nearest_increment_value_1=require(_0x190f77(0xf0)),drop_exclude_share_1=require(_0x190f77(0x124)),stratagies_names_1=require(_0x190f77(0x146)),perf_hooks_1=require(_0x190f77(0x11e)),CHANK_SIZE=0x12c;class DropShares{constructor(_0x4e2a94,_0x5a25fd,_0x408859){const _0x2ab971=_0x190f77;this[_0x2ab971(0x15b)]=_0x4e2a94,this[_0x2ab971(0x133)]=_0x408859,this[_0x2ab971(0x11c)]=![],this['halt']=![],this[_0x2ab971(0x163)]=[],this[_0x2ab971(0x106)]=new rxjs_1['Subject'](),this['margins']={},this[_0x2ab971(0x125)]=new Set(),this[_0x2ab971(0x116)]=_0x5a25fd,this[_0x2ab971(0x106)][_0x2ab971(0xf6)]((0x0,rxjs_1[_0x2ab971(0x101)])(()=>!this[_0x2ab971(0xfd)]),(0x0,rxjs_1[_0x2ab971(0x13e)])(()=>{const _0x1f3108=_0x2ab971;!this['halt']&&(this[_0x1f3108(0xfd)]=!![],setTimeout(()=>this[_0x1f3108(0xfd)]=![],this[_0x1f3108(0x116)]['haltTimeout']));}),(0x0,rxjs_1[_0x2ab971(0x13e)])(_0x317f1b=>{const _0x3bdb04=_0x2ab971;this[_0x3bdb04(0x133)][_0x3bdb04(0x111)](this[_0x3bdb04(0x14e)],_0x317f1b[_0x3bdb04(0x10b)],_0x317f1b['share'],stratagies_names_1[_0x3bdb04(0x108)][_0x3bdb04(0x114)]);}))['subscribe']();}async[_0x190f77(0xf9)](_0x1bb1f4,_0x30dc14,_0x17dbc0,_0x50aad4){const _0x1f06dd=_0x190f77;this[_0x1f06dd(0x11c)]=![];const _0xca2acc=perf_hooks_1[_0x1f06dd(0x122)][_0x1f06dd(0x10a)](),_0x59e00b=await this[_0x1f06dd(0x15b)]['instruments'][_0x1f06dd(0x109)]({'instrumentStatus':instruments_1[_0x1f06dd(0x155)][_0x1f06dd(0xf7)]}),_0x5a0db5=perf_hooks_1[_0x1f06dd(0x122)]['now']();console['log'](_0x1f06dd(0x142)+(_0x5a0db5-_0xca2acc)[_0x1f06dd(0xfe)](0x2)+_0x1f06dd(0x123)),(0x0,rxjs_1[_0x1f06dd(0x136)])([_0x1bb1f4,_0x30dc14,_0x17dbc0,_0x50aad4])[_0x1f06dd(0x118)](_0x33c55f=>{const _0x3f039a=_0x1f06dd;this[_0x3f039a(0x144)]=_0x33c55f[0x0],this[_0x3f039a(0x103)]=_0x33c55f[0x1],this[_0x3f039a(0x113)]=_0x33c55f[0x2],this[_0x3f039a(0x158)]=_0x33c55f[0x3],this[_0x3f039a(0x12b)](_0x59e00b[_0x3f039a(0x12a)]);});const _0x216e2d=_0x59e00b[_0x1f06dd(0x12a)]['filter'](_0x21b20d=>_0x21b20d[_0x1f06dd(0x130)][_0x1f06dd(0x129)](_0x1f06dd(0x15e)));this[_0x1f06dd(0x14e)]={};for(const _0x5531a8 of _0x216e2d){await new Promise(_0xe46fb7=>setTimeout(_0xe46fb7,0x12c)),this[_0x1f06dd(0x14e)][_0x5531a8[_0x1f06dd(0x161)]]=await this[_0x1f06dd(0x15b)]['instruments'][_0x1f06dd(0xf5)]({'figi':_0x5531a8['figi']});}const _0x4a1138=[];for(let _0x40dc57=0x0;_0x40dc57<_0x216e2d['length'];_0x40dc57+=CHANK_SIZE){_0x4a1138[_0x1f06dd(0x131)](_0x216e2d[_0x1f06dd(0xf2)](_0x40dc57,_0x40dc57+CHANK_SIZE));}_0x4a1138[_0x1f06dd(0x15a)]((_0x5dad6c,_0x1974f4)=>{const _0x3c2d24=_0x1f06dd,_0x4fb891=this['api'][_0x3c2d24(0x120)]()[_0x3c2d24(0x117)]({'instruments':_0x5dad6c[_0x3c2d24(0x150)](_0x667a5a=>({'figi':_0x667a5a[_0x3c2d24(0x161)],'interval':marketdata_1[_0x3c2d24(0x12f)][_0x3c2d24(0x156)]})),'waitingClose':![]},_0x498bbb=>this[_0x3c2d24(0x15f)](_0x498bbb,_0x5dad6c));setTimeout(()=>{const _0x37f9d1=_0x3c2d24;(0x0,rxjs_1['from'])(_0x4fb891)[_0x37f9d1(0x118)](_0x26db0c=>{const _0xda8369=_0x37f9d1;!this[_0xda8369(0x11c)]?(console['log'](_0xda8369(0x140)+_0x4a1138['length']+_0xda8369(0x107)),this[_0xda8369(0x163)]['push'](_0x26db0c)):_0x26db0c();});},_0x1974f4*0x3e8);}),this['api'][_0x1f06dd(0x10f)][_0x1f06dd(0x134)]['on'](_0x1f06dd(0x12e),_0x726495=>console['log'](_0x1f06dd(0x14c),_0x726495)),this[_0x1f06dd(0x15b)][_0x1f06dd(0x10f)][_0x1f06dd(0x134)]['on'](_0x1f06dd(0x100),_0xb5efe7=>console[_0x1f06dd(0x102)](_0x1f06dd(0x13f),_0xb5efe7));}['stop'](){const _0x2a4bc9=_0x190f77;Promise[_0x2a4bc9(0x14a)](this[_0x2a4bc9(0x163)])['then'](),this[_0x2a4bc9(0x11c)]=!![];}['setUnavaliableShares'](_0xacdf03){const _0x6bdd79=_0x190f77;this[_0x6bdd79(0x125)]=new Set(),_0xacdf03[_0x6bdd79(0x15a)](_0x33891e=>{const _0x4c9869=_0x6bdd79;(0x0,drop_exclude_share_1[_0x4c9869(0x138)])(_0x33891e,this[_0x4c9869(0x116)][_0x4c9869(0x12c)])&&this[_0x4c9869(0x125)][_0x4c9869(0xfc)](_0x33891e[_0x4c9869(0x14d)]);if((0x0,drop_exclude_share_1[_0x4c9869(0x164)])(_0x33891e,this[_0x4c9869(0x116)]))this['unavaliableShares'][_0x4c9869(0xfc)](_0x33891e[_0x4c9869(0x14d)]);if(!_0x33891e['exchange'][_0x4c9869(0x129)]('FORTS_EVENING')){if((0x0,drop_exclude_share_1[_0x4c9869(0x135)])(_0x33891e,this['options']))this[_0x4c9869(0x125)][_0x4c9869(0xfc)](_0x33891e['ticker']);if((0x0,drop_exclude_share_1[_0x4c9869(0x154)])(_0x33891e,this[_0x4c9869(0x103)]))this[_0x4c9869(0x125)]['add'](_0x33891e[_0x4c9869(0x14d)]);if(!this[_0x4c9869(0x116)]['includeReports']&&(0x0,drop_exclude_share_1[_0x4c9869(0x13d)])(_0x33891e,this[_0x4c9869(0x158)]))this[_0x4c9869(0x125)]['add'](_0x33891e[_0x4c9869(0x14d)]);if((0x0,drop_exclude_share_1[_0x4c9869(0x139)])(_0x33891e,this['shareHalts']))this[_0x4c9869(0x125)][_0x4c9869(0xfc)](_0x33891e[_0x4c9869(0x14d)]);if((0x0,drop_exclude_share_1[_0x4c9869(0x162)])(_0x33891e,this[_0x4c9869(0x144)]))this[_0x4c9869(0x125)][_0x4c9869(0xfc)](_0x33891e[_0x4c9869(0x14d)]);const _0x2f973a=moment(),_0x19f35f=moment()[_0x4c9869(0x11a)]('day')[_0x4c9869(0xfc)](0x11,_0x4c9869(0x104))[_0x4c9869(0xfc)](0x19,_0x4c9869(0xf1)),_0x3710a9=moment()[_0x4c9869(0x110)](_0x4c9869(0xf8));_0x2f973a[_0x4c9869(0x119)](_0x19f35f)&&_0x2f973a['isSameOrBefore'](_0x3710a9)&&!this['options'][_0x4c9869(0x11b)]&&this[_0x4c9869(0x125)][_0x4c9869(0xfc)](_0x33891e[_0x4c9869(0x14d)]),_0x2f973a[_0x4c9869(0xf4)](_0x19f35f)&&_0x2f973a[_0x4c9869(0x119)](_0x3710a9)&&this[_0x4c9869(0x125)][_0x4c9869(0xfc)](_0x33891e['ticker']);}});}[_0x190f77(0x15d)](_0x488d0b){const _0x156115=_0x190f77;if(this[_0x156115(0x125)][_0x156115(0x159)](_0x488d0b[_0x156115(0x14d)]))return![];return!![];}[_0x190f77(0x15f)](_0x51ee7e,_0x44b85a){const _0x393691=_0x190f77;var _0x19a490;const _0x4f22f4=_0x44b85a[_0x393691(0x141)](_0x2329a9=>_0x2329a9[_0x393691(0x161)]===_0x51ee7e[_0x393691(0x161)]);if(this[_0x393691(0x15d)](_0x4f22f4)){const {open:_0x419f8e,low:_0x2b40d1}=_0x51ee7e,_0x2c51d1=tinkoff_invest_api_1['Helpers'][_0x393691(0x160)](_0x2b40d1),_0x9df4d=tinkoff_invest_api_1['Helpers']['toNumber'](_0x419f8e),_0x1f86e0=Array[_0x393691(0x14f)]((_0x19a490=this[_0x393691(0x116)])===null||_0x19a490===void 0x0?void 0x0:_0x19a490[_0x393691(0xfb)])&&this['options'][_0x393691(0xfb)]['find'](_0x20e545=>_0x20e545['figi']===_0x4f22f4[_0x393691(0x161)]);_0x4f22f4[_0x393691(0x130)][_0x393691(0x129)](_0x393691(0x15e))?_0x9df4d*((_0x1f86e0===null||_0x1f86e0===void 0x0?void 0x0:_0x1f86e0[_0x393691(0x153)])||this[_0x393691(0x116)][_0x393691(0x145)])>=_0x2c51d1&&this[_0x393691(0x106)][_0x393691(0x143)]({'price':this[_0x393691(0x105)](_0x2c51d1,_0x9df4d-_0x2c51d1,_0x4f22f4,_0x1f86e0),'share':_0x4f22f4,'money':_0x1f86e0===null||_0x1f86e0===void 0x0?void 0x0:_0x1f86e0[_0x393691(0x112)]}):_0x9df4d*((_0x1f86e0===null||_0x1f86e0===void 0x0?void 0x0:_0x1f86e0[_0x393691(0x153)])||this['options'][_0x393691(0xff)])>=_0x2c51d1&&_0x2c51d1>0x5&&this[_0x393691(0x106)][_0x393691(0x143)]({'price':this[_0x393691(0x105)](_0x2c51d1,_0x9df4d-_0x2c51d1,_0x4f22f4,_0x1f86e0),'share':_0x4f22f4,'money':_0x1f86e0===null||_0x1f86e0===void 0x0?void 0x0:_0x1f86e0[_0x393691(0x112)]});}}[_0x190f77(0x105)](_0x267fa0,_0x589459,_0x3ae667,_0x4badc3){const _0x36206a=_0x190f77,_0x539fb4=tinkoff_invest_api_1[_0x36206a(0x166)]['toNumber'](_0x3ae667[_0x36206a(0x128)]);if(_0x3ae667[_0x36206a(0x130)][_0x36206a(0x129)](_0x36206a(0x15e)))return(0x0,nearest_increment_value_1[_0x36206a(0x151)])(_0x267fa0+_0x589459*((_0x4badc3===null||_0x4badc3===void 0x0?void 0x0:_0x4badc3['diffSharesBuy'])||this[_0x36206a(0x116)]['moexDiffSharesBuy']),_0x539fb4);return _0x267fa0<0x5?(0x0,nearest_increment_value_1[_0x36206a(0x151)])(_0x267fa0+_0x539fb4,_0x539fb4):(0x0,nearest_increment_value_1[_0x36206a(0x151)])(_0x267fa0+_0x589459*((_0x4badc3===null||_0x4badc3===void 0x0?void 0x0:_0x4badc3[_0x36206a(0x12d)])||this[_0x36206a(0x116)]['foreignDiffSharesBuy']),_0x539fb4);}[_0x190f77(0x127)](_0x337026){const _0x2596f0=_0x190f77;this['options']=_0x337026;const _0x276ea2=perf_hooks_1['performance'][_0x2596f0(0x10a)]();this['api'][_0x2596f0(0x12a)][_0x2596f0(0x109)]({'instrumentStatus':instruments_1[_0x2596f0(0x155)][_0x2596f0(0xf7)]})[_0x2596f0(0x10e)](_0x267226=>{const _0x34565d=_0x2596f0,_0x1dcd42=perf_hooks_1[_0x34565d(0x122)]['now']();console[_0x34565d(0x102)](_0x34565d(0x10c)+(_0x1dcd42-_0x276ea2)[_0x34565d(0xfe)](0x2)+_0x34565d(0x123)),console[_0x34565d(0x102)](_0x34565d(0x147),_0x34565d(0x13c),'\x1b[37m'),this[_0x34565d(0x12b)](_0x267226[_0x34565d(0x12a)]);});}}exports[_0x190f77(0x115)]=DropShares;function _0x3436(){const _0x396688=['performance','\x20мс','./drop.exclude-share','unavaliableShares','1465IviUWS','reloadOptions','minPriceIncrement','includes','instruments','setUnavaliableShares','except','diffSharesBuy','error','SubscriptionInterval','exchange','push','13383788QWhPRZ','wallet','market','excludeByHealth','combineLatest','245063nLhQup','excludeByList','excludeByHalts','300496aYjPAc','10tLXKcV','Параметры\x20Слеза:\x20обновлены','excludeByReports','tap','stream\x20closed,\x20reason:','Чанк\x20','find','Время\x20запроса\x20futures:\x20','next','shareDividends','moexDiffShares','./stratagies.names','\x1b[36m%s\x1b[0m','1613178LGRHoC','184aTgPKK','all','defineProperty','stream\x20error','ticker','margins','isArray','map','nearestHighIncrementValue','tinkoff-invest-api/cjs/generated/instruments','diffShares','excludeByFDA','InstrumentStatus','SUBSCRIPTION_INTERVAL_ONE_MINUTE','1MVIaDU','shareReports','has','forEach','api','21BeFytL','allowTo','FORTS_EVENING','processOnCandle','toNumber','figi','excludeByDividends','unsubscribes','excludeByExchange','3966WIVbwt','Helpers','../utils/nearest-increment-value','minutes','slice','7627092LoBMoJ','isSameOrBefore','getFuturesMargin','pipe','INSTRUMENT_STATUS_BASE','day','start','moment','sharesSettings','add','halt','toFixed','foreignDiffShares','close','filter','log','shareFDA','hours','getPrice','buyTheDrop','\x20запущен','STRATAGIES_NAMES','futures','now','price','Время\x20запроса\x20futures\x20в\x20reloadOptions:\x20','__esModule','then','stream','endOf','buy','maxMoneySize','shareHalts','DROP','DropShares','options','candles','subscribe','isSameOrAfter','startOf','includeMS','stoped','rxjs','perf_hooks','3099994XBxrFU','createMarketStream','tinkoff-invest-api/cjs/generated/marketdata'];_0x3436=function(){return _0x396688;};return _0x3436();}