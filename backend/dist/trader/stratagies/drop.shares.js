'use strict';const _0x493dd6=_0x4074;(function(_0x4c1a07,_0x1270d3){const _0x3bf8fd=_0x4074,_0x4de9cb=_0x4c1a07();while(!![]){try{const _0x4bc415=parseInt(_0x3bf8fd(0x1e0))/0x1+parseInt(_0x3bf8fd(0x1fd))/0x2*(parseInt(_0x3bf8fd(0x20b))/0x3)+parseInt(_0x3bf8fd(0x1ed))/0x4+parseInt(_0x3bf8fd(0x1cb))/0x5*(-parseInt(_0x3bf8fd(0x1c7))/0x6)+-parseInt(_0x3bf8fd(0x206))/0x7*(parseInt(_0x3bf8fd(0x1b7))/0x8)+parseInt(_0x3bf8fd(0x208))/0x9*(parseInt(_0x3bf8fd(0x21e))/0xa)+-parseInt(_0x3bf8fd(0x1bb))/0xb;if(_0x4bc415===_0x1270d3)break;else _0x4de9cb['push'](_0x4de9cb['shift']());}catch(_0x258b87){_0x4de9cb['push'](_0x4de9cb['shift']());}}}(_0x3f56,0xe5cc8));function _0x4074(_0x34386b,_0x30ecaf){const _0x3f569e=_0x3f56();return _0x4074=function(_0x4074e9,_0x399b7f){_0x4074e9=_0x4074e9-0x1ac;let _0x3ea56e=_0x3f569e[_0x4074e9];return _0x3ea56e;},_0x4074(_0x34386b,_0x30ecaf);}Object[_0x493dd6(0x201)](exports,_0x493dd6(0x1dc),{'value':!![]}),exports[_0x493dd6(0x1d2)]=void 0x0;function _0x3f56(){const _0x317900=['halt','margins','moexDiffShares','defineProperty','excludeByFDA','STRATAGIES_NAMES','map','getPrice','2885911Mwuign','shareDividends','6543YSjfqn','excludeByDividends','allowTo','2888808oPMePu','close','instruments','minutes','isSameOrAfter','Время\x20запроса\x20futures:\x20','length','subscribe','InstrumentStatus','stream\x20error','excludeByReports','Параметры\x20Слеза:\x20обновлены','SubscriptionInterval','candles','shareHalts','share','SUBSCRIPTION_INTERVAL_ONE_MINUTE','moexDiffSharesBuy','Helpers','19510CKMVcw','./stratagies.names','Subject','createMarketStream','\x20мс','shareFDA','nearestHighIncrementValue','excludeByHalts','perf_hooks','unavaliableShares','exchange','includes','shareReports','includeMS','24wDBizB','Время\x20запроса\x20futures\x20в\x20reloadOptions:\x20','stoped','maxMoneySize','4750031pYxLtf','\x1b[36m%s\x1b[0m','foreignDiffShares','rxjs','has','push','next','buyTheDrop','forEach','filter','stream','DROP','10605930ICbhHC','foreignDiffSharesBuy','market','performance','5UIRxIN','buy','tinkoff-invest-api/cjs/generated/instruments','../utils/nearest-increment-value','tinkoff-invest-api','forts_futures_weekend','day','DropShares','add','haltTimeout','./drop.exclude-share','find','error','now','\x20запущен','includeReports','figi','__esModule','ticker','\x1b[37m','reloadOptions','809937Uubdww','endOf','moment','toFixed','from','excludeByHealth','excludeByExchange','futures','api','setUnavaliableShares','processOnCandle','except','INSTRUMENT_STATUS_BASE','4745204fRowTc','toNumber','log','Чанк\x20','isSameOrBefore','all','excludeByList','diffSharesBuy','options','sharesSettings','unsubscribes','stop','diffShares','combineLatest','isArray','tap','2nuUlvU'];_0x3f56=function(){return _0x317900;};return _0x3f56();}const moment=require(_0x493dd6(0x1e2)),rxjs_1=require(_0x493dd6(0x1be)),tinkoff_invest_api_1=require(_0x493dd6(0x1cf)),instruments_1=require(_0x493dd6(0x1cd)),marketdata_1=require('tinkoff-invest-api/cjs/generated/marketdata'),nearest_increment_value_1=require(_0x493dd6(0x1ce)),drop_exclude_share_1=require(_0x493dd6(0x1d5)),stratagies_names_1=require(_0x493dd6(0x21f)),perf_hooks_1=require(_0x493dd6(0x1b1)),CHANK_SIZE=0x12c;class DropShares{constructor(_0x2166ed,_0x2ec880,_0x22897c){const _0x31897c=_0x493dd6;this['api']=_0x2166ed,this['wallet']=_0x22897c,this[_0x31897c(0x1b9)]=![],this['halt']=![],this['unsubscribes']=[],this[_0x31897c(0x1c2)]=new rxjs_1[(_0x31897c(0x220))](),this['margins']={},this[_0x31897c(0x1b2)]=new Set(),this[_0x31897c(0x1f5)]=_0x2ec880,this['buyTheDrop']['pipe']((0x0,rxjs_1['filter'])(()=>!this[_0x31897c(0x1fe)]),(0x0,rxjs_1[_0x31897c(0x1fc)])(()=>{const _0x169712=_0x31897c;!this[_0x169712(0x1fe)]&&(this[_0x169712(0x1fe)]=!![],setTimeout(()=>this[_0x169712(0x1fe)]=![],this[_0x169712(0x1f5)][_0x169712(0x1d4)]));}),(0x0,rxjs_1['tap'])(_0x575e2d=>{const _0x294a34=_0x31897c;this['wallet'][_0x294a34(0x1cc)](this[_0x294a34(0x1ff)],_0x575e2d['price'],_0x575e2d[_0x294a34(0x21a)],stratagies_names_1[_0x294a34(0x203)][_0x294a34(0x1c6)]);}))[_0x31897c(0x212)]();}async['start'](_0x24c4fe,_0x1b78b5,_0x31d1f8,_0x174959){const _0x44d44d=_0x493dd6;this[_0x44d44d(0x1b9)]=![];const _0x45fdf5=perf_hooks_1['performance'][_0x44d44d(0x1d8)](),_0x47dffd=await this[_0x44d44d(0x1e8)][_0x44d44d(0x20d)][_0x44d44d(0x1e7)]({'instrumentStatus':instruments_1[_0x44d44d(0x213)][_0x44d44d(0x1ec)]}),_0x3e40f3=perf_hooks_1[_0x44d44d(0x1ca)][_0x44d44d(0x1d8)]();console[_0x44d44d(0x1ef)](_0x44d44d(0x210)+(_0x3e40f3-_0x45fdf5)['toFixed'](0x2)+'\x20мс'),(0x0,rxjs_1[_0x44d44d(0x1fa)])([_0x24c4fe,_0x1b78b5,_0x31d1f8,_0x174959])[_0x44d44d(0x212)](_0x5a0f0b=>{const _0x2c4f77=_0x44d44d;this['shareDividends']=_0x5a0f0b[0x0],this['shareFDA']=_0x5a0f0b[0x1],this[_0x2c4f77(0x219)]=_0x5a0f0b[0x2],this['shareReports']=_0x5a0f0b[0x3],this[_0x2c4f77(0x1e9)](_0x47dffd['instruments']);});const _0x25c5a1=_0x47dffd['instruments'][_0x44d44d(0x1c4)](_0x20cb39=>_0x20cb39[_0x44d44d(0x1b3)][_0x44d44d(0x1b4)](_0x44d44d(0x1d0)));this[_0x44d44d(0x1ff)]={};for(const _0x41c166 of _0x25c5a1){await new Promise(_0x390ebe=>setTimeout(_0x390ebe,0x12c)),this[_0x44d44d(0x1ff)][_0x41c166[_0x44d44d(0x1db)]]=await this['api'][_0x44d44d(0x20d)]['getFuturesMargin']({'figi':_0x41c166[_0x44d44d(0x1db)]});}const _0xefca32=[];for(let _0x4ec5bf=0x0;_0x4ec5bf<_0x25c5a1[_0x44d44d(0x211)];_0x4ec5bf+=CHANK_SIZE){_0xefca32[_0x44d44d(0x1c0)](_0x25c5a1['slice'](_0x4ec5bf,_0x4ec5bf+CHANK_SIZE));}_0xefca32[_0x44d44d(0x1c3)]((_0x34eea9,_0x4b0a2c)=>{const _0x46f073=_0x44d44d,_0x5557b1=this['api'][_0x46f073(0x1ac)]()[_0x46f073(0x218)]({'instruments':_0x34eea9[_0x46f073(0x204)](_0x1eeeb0=>({'figi':_0x1eeeb0[_0x46f073(0x1db)],'interval':marketdata_1[_0x46f073(0x217)][_0x46f073(0x21b)]})),'waitingClose':![]},_0x1026a3=>this[_0x46f073(0x1ea)](_0x1026a3,_0x34eea9));setTimeout(()=>{const _0xbbcb4=_0x46f073;(0x0,rxjs_1[_0xbbcb4(0x1e4)])(_0x5557b1)[_0xbbcb4(0x212)](_0xded7cf=>{const _0xf42864=_0xbbcb4;!this[_0xf42864(0x1b9)]?(console[_0xf42864(0x1ef)](_0xf42864(0x1f0)+_0xefca32[_0xf42864(0x211)]+_0xf42864(0x1d9)),this[_0xf42864(0x1f7)][_0xf42864(0x1c0)](_0xded7cf)):_0xded7cf();});},_0x4b0a2c*0x3e8);}),this['api'][_0x44d44d(0x1c5)]['market']['on'](_0x44d44d(0x1d7),_0x3c949a=>console[_0x44d44d(0x1ef)](_0x44d44d(0x214),_0x3c949a)),this[_0x44d44d(0x1e8)]['stream'][_0x44d44d(0x1c9)]['on'](_0x44d44d(0x20c),_0x1e35dd=>console[_0x44d44d(0x1ef)]('stream\x20closed,\x20reason:',_0x1e35dd));}[_0x493dd6(0x1f8)](){const _0x57ede9=_0x493dd6;Promise[_0x57ede9(0x1f2)](this[_0x57ede9(0x1f7)])['then'](),this[_0x57ede9(0x1b9)]=!![];}[_0x493dd6(0x1e9)](_0x488093){const _0x18e88e=_0x493dd6;this[_0x18e88e(0x1b2)]=new Set(),_0x488093['forEach'](_0x1db2b1=>{const _0x188e13=_0x18e88e;(0x0,drop_exclude_share_1[_0x188e13(0x1f3)])(_0x1db2b1,this[_0x188e13(0x1f5)][_0x188e13(0x1eb)])&&this['unavaliableShares'][_0x188e13(0x1d3)](_0x1db2b1[_0x188e13(0x1dd)]);if((0x0,drop_exclude_share_1[_0x188e13(0x1e6)])(_0x1db2b1,this['options']))this[_0x188e13(0x1b2)][_0x188e13(0x1d3)](_0x1db2b1['ticker']);if(!_0x1db2b1[_0x188e13(0x1b3)][_0x188e13(0x1b4)]('forts_futures_weekend')){if((0x0,drop_exclude_share_1[_0x188e13(0x1e5)])(_0x1db2b1,this[_0x188e13(0x1f5)]))this['unavaliableShares'][_0x188e13(0x1d3)](_0x1db2b1['ticker']);if((0x0,drop_exclude_share_1[_0x188e13(0x202)])(_0x1db2b1,this[_0x188e13(0x1ae)]))this[_0x188e13(0x1b2)]['add'](_0x1db2b1[_0x188e13(0x1dd)]);if(!this[_0x188e13(0x1f5)][_0x188e13(0x1da)]&&(0x0,drop_exclude_share_1[_0x188e13(0x215)])(_0x1db2b1,this[_0x188e13(0x1b5)]))this[_0x188e13(0x1b2)]['add'](_0x1db2b1['ticker']);if((0x0,drop_exclude_share_1[_0x188e13(0x1b0)])(_0x1db2b1,this[_0x188e13(0x219)]))this['unavaliableShares']['add'](_0x1db2b1[_0x188e13(0x1dd)]);if((0x0,drop_exclude_share_1[_0x188e13(0x209)])(_0x1db2b1,this[_0x188e13(0x207)]))this[_0x188e13(0x1b2)][_0x188e13(0x1d3)](_0x1db2b1[_0x188e13(0x1dd)]);const _0x2e6938=moment(),_0x27a44e=moment()['startOf'](_0x188e13(0x1d1))[_0x188e13(0x1d3)](0x11,'hours')[_0x188e13(0x1d3)](0x19,_0x188e13(0x20e)),_0x171249=moment()[_0x188e13(0x1e1)](_0x188e13(0x1d1));_0x2e6938[_0x188e13(0x20f)](_0x27a44e)&&_0x2e6938[_0x188e13(0x1f1)](_0x171249)&&!this[_0x188e13(0x1f5)][_0x188e13(0x1b6)]&&this[_0x188e13(0x1b2)][_0x188e13(0x1d3)](_0x1db2b1[_0x188e13(0x1dd)]),_0x2e6938[_0x188e13(0x1f1)](_0x27a44e)&&_0x2e6938[_0x188e13(0x20f)](_0x171249)&&this[_0x188e13(0x1b2)]['add'](_0x1db2b1[_0x188e13(0x1dd)]);}});}['allowTo'](_0x3cdebb){const _0x5673de=_0x493dd6;if(this[_0x5673de(0x1b2)][_0x5673de(0x1bf)](_0x3cdebb['ticker']))return![];return!![];}[_0x493dd6(0x1ea)](_0x5ddfe1,_0x4943c4){const _0x32884a=_0x493dd6;var _0x5873a0;const _0x13f80e=_0x4943c4[_0x32884a(0x1d6)](_0x252bf6=>_0x252bf6[_0x32884a(0x1db)]===_0x5ddfe1[_0x32884a(0x1db)]);if(this[_0x32884a(0x20a)](_0x13f80e)){const {open:_0x5854b1,low:_0xcb1eed}=_0x5ddfe1,_0x4840e0=tinkoff_invest_api_1[_0x32884a(0x21d)]['toNumber'](_0xcb1eed),_0x3b07bc=tinkoff_invest_api_1['Helpers'][_0x32884a(0x1ee)](_0x5854b1),_0x41b54e=Array[_0x32884a(0x1fb)]((_0x5873a0=this[_0x32884a(0x1f5)])===null||_0x5873a0===void 0x0?void 0x0:_0x5873a0['sharesSettings'])&&this[_0x32884a(0x1f5)][_0x32884a(0x1f6)][_0x32884a(0x1d6)](_0x52c423=>_0x52c423['figi']===_0x13f80e[_0x32884a(0x1db)]);_0x13f80e[_0x32884a(0x1b3)][_0x32884a(0x1b4)](_0x32884a(0x1d0))?_0x3b07bc*((_0x41b54e===null||_0x41b54e===void 0x0?void 0x0:_0x41b54e[_0x32884a(0x1f9)])||this[_0x32884a(0x1f5)][_0x32884a(0x200)])>=_0x4840e0&&this[_0x32884a(0x1c2)]['next']({'price':this[_0x32884a(0x205)](_0x4840e0,_0x3b07bc-_0x4840e0,_0x13f80e,_0x41b54e),'share':_0x13f80e,'money':_0x41b54e===null||_0x41b54e===void 0x0?void 0x0:_0x41b54e[_0x32884a(0x1ba)]}):_0x3b07bc*((_0x41b54e===null||_0x41b54e===void 0x0?void 0x0:_0x41b54e[_0x32884a(0x1f9)])||this[_0x32884a(0x1f5)][_0x32884a(0x1bd)])>=_0x4840e0&&_0x4840e0>0x5&&this[_0x32884a(0x1c2)][_0x32884a(0x1c1)]({'price':this[_0x32884a(0x205)](_0x4840e0,_0x3b07bc-_0x4840e0,_0x13f80e,_0x41b54e),'share':_0x13f80e,'money':_0x41b54e===null||_0x41b54e===void 0x0?void 0x0:_0x41b54e[_0x32884a(0x1ba)]});}}[_0x493dd6(0x205)](_0x4d4cbd,_0x26350d,_0x46886f,_0x28308f){const _0x132def=_0x493dd6,_0xa2ab84=tinkoff_invest_api_1[_0x132def(0x21d)][_0x132def(0x1ee)](_0x46886f['minPriceIncrement']);if(_0x46886f['exchange'][_0x132def(0x1b4)](_0x132def(0x1d0)))return(0x0,nearest_increment_value_1['nearestHighIncrementValue'])(_0x4d4cbd+_0x26350d*((_0x28308f===null||_0x28308f===void 0x0?void 0x0:_0x28308f[_0x132def(0x1f4)])||this['options'][_0x132def(0x21c)]),_0xa2ab84);return _0x4d4cbd<0x5?(0x0,nearest_increment_value_1[_0x132def(0x1af)])(_0x4d4cbd+_0xa2ab84,_0xa2ab84):(0x0,nearest_increment_value_1['nearestHighIncrementValue'])(_0x4d4cbd+_0x26350d*((_0x28308f===null||_0x28308f===void 0x0?void 0x0:_0x28308f[_0x132def(0x1f4)])||this['options'][_0x132def(0x1c8)]),_0xa2ab84);}[_0x493dd6(0x1df)](_0x70e6b2){const _0x24a4be=_0x493dd6;this[_0x24a4be(0x1f5)]=_0x70e6b2;const _0x35154d=perf_hooks_1[_0x24a4be(0x1ca)][_0x24a4be(0x1d8)]();this[_0x24a4be(0x1e8)][_0x24a4be(0x20d)][_0x24a4be(0x1e7)]({'instrumentStatus':instruments_1['InstrumentStatus'][_0x24a4be(0x1ec)]})['then'](_0x20895d=>{const _0x481e5a=_0x24a4be,_0x3a0198=perf_hooks_1[_0x481e5a(0x1ca)][_0x481e5a(0x1d8)]();console['log'](_0x481e5a(0x1b8)+(_0x3a0198-_0x35154d)[_0x481e5a(0x1e3)](0x2)+_0x481e5a(0x1ad)),console[_0x481e5a(0x1ef)](_0x481e5a(0x1bc),_0x481e5a(0x216),_0x481e5a(0x1de)),this[_0x481e5a(0x1e9)](_0x20895d['instruments']);});}}exports[_0x493dd6(0x1d2)]=DropShares;