'use strict';const _0x5454a4=_0x1b18;(function(_0x5b022b,_0x17102c){const _0x570a9c=_0x1b18,_0x4c19e2=_0x5b022b();while(!![]){try{const _0x28f2a8=-parseInt(_0x570a9c(0xb1))/0x1*(parseInt(_0x570a9c(0x9b))/0x2)+-parseInt(_0x570a9c(0xb4))/0x3*(parseInt(_0x570a9c(0xe0))/0x4)+-parseInt(_0x570a9c(0xe2))/0x5*(parseInt(_0x570a9c(0xf6))/0x6)+-parseInt(_0x570a9c(0xa6))/0x7*(-parseInt(_0x570a9c(0xe1))/0x8)+parseInt(_0x570a9c(0xa5))/0x9+parseInt(_0x570a9c(0xa7))/0xa+parseInt(_0x570a9c(0x98))/0xb*(-parseInt(_0x570a9c(0x9c))/0xc);if(_0x28f2a8===_0x17102c)break;else _0x4c19e2['push'](_0x4c19e2['shift']());}catch(_0x4d410b){_0x4c19e2['push'](_0x4c19e2['shift']());}}}(_0x3deb,0x6ccf5));Object[_0x5454a4(0xc8)](exports,'__esModule',{'value':!![]}),exports[_0x5454a4(0xda)]=void 0x0;function _0x3deb(){const _0x493e68=['now','toFixed','minutes','excludeByFDA','then','figi','toNumber','STRATAGIES_NAMES','isArray','38766iPnKKu','shareFDA','tap','instruments','price','excludeByExchange','stoped','all','moexDiffShares','allowTo','log','SubscriptionInterval','exchange','Параметры\x20Слеза:\x20обновлены','forEach','push','Время\x20запроса\x20futures\x20в\x20reloadOptions:\x20','\x1b[36m%s\x1b[0m','75251kkscpl','maxMoneySize','createMarketStream','902SLwEgX','336lgsLPT','\x20запущен','options','stream','tinkoff-invest-api/cjs/generated/instruments','unsubscribes','hours','slice','haltTimeout','7076115dNBher','7cpPQiu','434100gjguqp','SUBSCRIPTION_INTERVAL_ONE_MINUTE','isSameOrBefore','pipe','includes','performance','except','buyTheDrop','setUnavaliableShares','diffShares','647FGHXSI','shareDividends','shareReports','3GNmNWT','startOf','margins','start','futures','moexDiffSharesBuy','\x20мс','halt','stream\x20closed,\x20reason:','shareHalts','map','InstrumentStatus','close','Время\x20запроса\x20futures:\x20','excludeByHealth','tinkoff-invest-api','./stratagies.names','day','stop','wallet','defineProperty','has','includeMS','processOnCandle','./drop.exclude-share','isSameOrAfter','unavaliableShares','combineLatest','stream\x20error','filter','find','Helpers','getFuturesMargin','INSTRUMENT_STATUS_BASE','nearestHighIncrementValue','api','minPriceIncrement','perf_hooks','DropShares','ticker','moment','diffSharesBuy','getPrice','FORTS_EVENING','30720piPDwg','1528464UGosPT','65TDytIJ','subscribe','excludeByReports','rxjs','add','includeReports','market','excludeByHalts','reloadOptions','excludeByDividends','buy'];_0x3deb=function(){return _0x493e68;};return _0x3deb();}function _0x1b18(_0x38aad8,_0x237114){const _0x3deba0=_0x3deb();return _0x1b18=function(_0x1b189f,_0xf29753){_0x1b189f=_0x1b189f-0x94;let _0x50989b=_0x3deba0[_0x1b189f];return _0x50989b;},_0x1b18(_0x38aad8,_0x237114);}const moment=require(_0x5454a4(0xdc)),rxjs_1=require(_0x5454a4(0xe5)),tinkoff_invest_api_1=require(_0x5454a4(0xc3)),instruments_1=require(_0x5454a4(0xa0)),marketdata_1=require('tinkoff-invest-api/cjs/generated/marketdata'),nearest_increment_value_1=require('../utils/nearest-increment-value'),drop_exclude_share_1=require(_0x5454a4(0xcc)),stratagies_names_1=require(_0x5454a4(0xc4)),perf_hooks_1=require(_0x5454a4(0xd9)),CHANK_SIZE=0x12c;class DropShares{constructor(_0x50fd22,_0x1b74d4,_0x1c4301){const _0x10fc3c=_0x5454a4;this[_0x10fc3c(0xd7)]=_0x50fd22,this[_0x10fc3c(0xc7)]=_0x1c4301,this[_0x10fc3c(0xfc)]=![],this['halt']=![],this[_0x10fc3c(0xa1)]=[],this['buyTheDrop']=new rxjs_1['Subject'](),this[_0x10fc3c(0xb6)]={},this['unavaliableShares']=new Set(),this[_0x10fc3c(0x9e)]=_0x1b74d4,this[_0x10fc3c(0xae)][_0x10fc3c(0xaa)]((0x0,rxjs_1[_0x10fc3c(0xd1)])(()=>!this[_0x10fc3c(0xbb)]),(0x0,rxjs_1[_0x10fc3c(0xf8)])(()=>{const _0x3739d7=_0x10fc3c;!this['halt']&&(this[_0x3739d7(0xbb)]=!![],setTimeout(()=>this[_0x3739d7(0xbb)]=![],this['options'][_0x3739d7(0xa4)]));}),(0x0,rxjs_1['tap'])(_0x94f3ce=>{const _0x119cb4=_0x10fc3c;this['wallet'][_0x119cb4(0xec)](this['margins'],_0x94f3ce[_0x119cb4(0xfa)],_0x94f3ce['share'],stratagies_names_1[_0x119cb4(0xf4)]['DROP']);}))[_0x10fc3c(0xe3)]();}async[_0x5454a4(0xb7)](_0xb600b6,_0x5d54cc,_0x2f6c19,_0x5d3dbf){const _0x5d205c=_0x5454a4;this[_0x5d205c(0xfc)]=![];const _0x22651b=perf_hooks_1[_0x5d205c(0xac)][_0x5d205c(0xed)](),_0x359a16=await this[_0x5d205c(0xd7)][_0x5d205c(0xf9)][_0x5d205c(0xb8)]({'instrumentStatus':instruments_1[_0x5d205c(0xbf)]['INSTRUMENT_STATUS_BASE']}),_0x24953b=perf_hooks_1[_0x5d205c(0xac)][_0x5d205c(0xed)]();console[_0x5d205c(0x100)](_0x5d205c(0xc1)+(_0x24953b-_0x22651b)[_0x5d205c(0xee)](0x2)+_0x5d205c(0xba)),(0x0,rxjs_1[_0x5d205c(0xcf)])([_0xb600b6,_0x5d54cc,_0x2f6c19,_0x5d3dbf])[_0x5d205c(0xe3)](_0x5d610b=>{const _0xe20657=_0x5d205c;this[_0xe20657(0xb2)]=_0x5d610b[0x0],this[_0xe20657(0xf7)]=_0x5d610b[0x1],this[_0xe20657(0xbd)]=_0x5d610b[0x2],this[_0xe20657(0xb3)]=_0x5d610b[0x3],this[_0xe20657(0xaf)](_0x359a16[_0xe20657(0xf9)]);});const _0x4f7e61=_0x359a16['instruments'][_0x5d205c(0xd1)](_0x53fd94=>_0x53fd94[_0x5d205c(0x102)][_0x5d205c(0xab)](_0x5d205c(0xdf)));this[_0x5d205c(0xb6)]={};for(const _0x261e3a of _0x4f7e61){await new Promise(_0x4df6a9=>setTimeout(_0x4df6a9,0x12c)),this[_0x5d205c(0xb6)][_0x261e3a[_0x5d205c(0xf2)]]=await this[_0x5d205c(0xd7)][_0x5d205c(0xf9)][_0x5d205c(0xd4)]({'figi':_0x261e3a[_0x5d205c(0xf2)]});}const _0x4d7f08=[];for(let _0x93cb21=0x0;_0x93cb21<_0x4f7e61['length'];_0x93cb21+=CHANK_SIZE){_0x4d7f08[_0x5d205c(0x95)](_0x4f7e61[_0x5d205c(0xa3)](_0x93cb21,_0x93cb21+CHANK_SIZE));}_0x4d7f08[_0x5d205c(0x94)]((_0xa077af,_0x2462e6)=>{const _0x3bab1e=_0x5d205c,_0x15f3b7=this['api'][_0x3bab1e(0x9a)]()['candles']({'instruments':_0xa077af[_0x3bab1e(0xbe)](_0x3ba6e9=>({'figi':_0x3ba6e9[_0x3bab1e(0xf2)],'interval':marketdata_1[_0x3bab1e(0x101)][_0x3bab1e(0xa8)]})),'waitingClose':![]},_0x4d4978=>this[_0x3bab1e(0xcb)](_0x4d4978,_0xa077af));setTimeout(()=>{const _0x399b2a=_0x3bab1e;(0x0,rxjs_1['from'])(_0x15f3b7)[_0x399b2a(0xe3)](_0x1510cb=>{const _0x12b6d3=_0x399b2a;!this[_0x12b6d3(0xfc)]?(console[_0x12b6d3(0x100)]('Чанк\x20'+_0x4d7f08['length']+_0x12b6d3(0x9d)),this['unsubscribes'][_0x12b6d3(0x95)](_0x1510cb)):_0x1510cb();});},_0x2462e6*0x3e8);}),this[_0x5d205c(0xd7)][_0x5d205c(0x9f)][_0x5d205c(0xe8)]['on']('error',_0x522258=>console['log'](_0x5d205c(0xd0),_0x522258)),this[_0x5d205c(0xd7)][_0x5d205c(0x9f)][_0x5d205c(0xe8)]['on'](_0x5d205c(0xc0),_0x2f94fd=>console[_0x5d205c(0x100)](_0x5d205c(0xbc),_0x2f94fd));}[_0x5454a4(0xc6)](){const _0x5c3fd2=_0x5454a4;Promise[_0x5c3fd2(0xfd)](this[_0x5c3fd2(0xa1)])['then'](),this[_0x5c3fd2(0xfc)]=!![];}[_0x5454a4(0xaf)](_0x1dd723){const _0x41932f=_0x5454a4;this[_0x41932f(0xce)]=new Set(),_0x1dd723['forEach'](_0x4768d1=>{const _0x4dd93b=_0x41932f;(0x0,drop_exclude_share_1['excludeByList'])(_0x4768d1,this[_0x4dd93b(0x9e)][_0x4dd93b(0xad)])&&this[_0x4dd93b(0xce)][_0x4dd93b(0xe6)](_0x4768d1[_0x4dd93b(0xdb)]);if((0x0,drop_exclude_share_1[_0x4dd93b(0xfb)])(_0x4768d1,this[_0x4dd93b(0x9e)]))this['unavaliableShares']['add'](_0x4768d1['ticker']);if(!_0x4768d1['exchange'][_0x4dd93b(0xab)](_0x4dd93b(0xdf))){if((0x0,drop_exclude_share_1[_0x4dd93b(0xc2)])(_0x4768d1,this[_0x4dd93b(0x9e)]))this[_0x4dd93b(0xce)]['add'](_0x4768d1[_0x4dd93b(0xdb)]);if((0x0,drop_exclude_share_1[_0x4dd93b(0xf0)])(_0x4768d1,this[_0x4dd93b(0xf7)]))this[_0x4dd93b(0xce)]['add'](_0x4768d1[_0x4dd93b(0xdb)]);if(!this[_0x4dd93b(0x9e)][_0x4dd93b(0xe7)]&&(0x0,drop_exclude_share_1[_0x4dd93b(0xe4)])(_0x4768d1,this[_0x4dd93b(0xb3)]))this['unavaliableShares']['add'](_0x4768d1[_0x4dd93b(0xdb)]);if((0x0,drop_exclude_share_1[_0x4dd93b(0xe9)])(_0x4768d1,this[_0x4dd93b(0xbd)]))this[_0x4dd93b(0xce)][_0x4dd93b(0xe6)](_0x4768d1[_0x4dd93b(0xdb)]);if((0x0,drop_exclude_share_1[_0x4dd93b(0xeb)])(_0x4768d1,this[_0x4dd93b(0xb2)]))this[_0x4dd93b(0xce)][_0x4dd93b(0xe6)](_0x4768d1['ticker']);const _0x485a9d=moment(),_0x54cb20=moment()[_0x4dd93b(0xb5)](_0x4dd93b(0xc5))[_0x4dd93b(0xe6)](0x11,_0x4dd93b(0xa2))['add'](0x19,_0x4dd93b(0xef)),_0x26fe2c=moment()['endOf']('day');_0x485a9d[_0x4dd93b(0xcd)](_0x54cb20)&&_0x485a9d[_0x4dd93b(0xa9)](_0x26fe2c)&&!this['options'][_0x4dd93b(0xca)]&&this[_0x4dd93b(0xce)][_0x4dd93b(0xe6)](_0x4768d1[_0x4dd93b(0xdb)]),_0x485a9d[_0x4dd93b(0xa9)](_0x54cb20)&&_0x485a9d[_0x4dd93b(0xcd)](_0x26fe2c)&&this[_0x4dd93b(0xce)]['add'](_0x4768d1[_0x4dd93b(0xdb)]);}});}[_0x5454a4(0xff)](_0x40978f){const _0x411be8=_0x5454a4;if(this[_0x411be8(0xce)][_0x411be8(0xc9)](_0x40978f[_0x411be8(0xdb)]))return![];return!![];}[_0x5454a4(0xcb)](_0x324782,_0x41ab01){const _0x95c645=_0x5454a4;var _0x2a2ef1;const _0x5a9a1f=_0x41ab01[_0x95c645(0xd2)](_0x468c5e=>_0x468c5e[_0x95c645(0xf2)]===_0x324782[_0x95c645(0xf2)]);if(this[_0x95c645(0xff)](_0x5a9a1f)){const {open:_0x11e613,low:_0x36176b}=_0x324782,_0x27cd04=tinkoff_invest_api_1[_0x95c645(0xd3)][_0x95c645(0xf3)](_0x36176b),_0x9894a8=tinkoff_invest_api_1[_0x95c645(0xd3)]['toNumber'](_0x11e613),_0x3c75cb=Array[_0x95c645(0xf5)]((_0x2a2ef1=this[_0x95c645(0x9e)])===null||_0x2a2ef1===void 0x0?void 0x0:_0x2a2ef1['sharesSettings'])&&this[_0x95c645(0x9e)]['sharesSettings']['find'](_0x2fc2af=>_0x2fc2af['figi']===_0x5a9a1f[_0x95c645(0xf2)]);_0x5a9a1f[_0x95c645(0x102)][_0x95c645(0xab)](_0x95c645(0xdf))?_0x9894a8*((_0x3c75cb===null||_0x3c75cb===void 0x0?void 0x0:_0x3c75cb['diffShares'])||this['options'][_0x95c645(0xfe)])>=_0x27cd04&&this[_0x95c645(0xae)]['next']({'price':this[_0x95c645(0xde)](_0x27cd04,_0x9894a8-_0x27cd04,_0x5a9a1f,_0x3c75cb),'share':_0x5a9a1f,'money':_0x3c75cb===null||_0x3c75cb===void 0x0?void 0x0:_0x3c75cb['maxMoneySize']}):_0x9894a8*((_0x3c75cb===null||_0x3c75cb===void 0x0?void 0x0:_0x3c75cb[_0x95c645(0xb0)])||this[_0x95c645(0x9e)]['foreignDiffShares'])>=_0x27cd04&&_0x27cd04>0x5&&this[_0x95c645(0xae)]['next']({'price':this['getPrice'](_0x27cd04,_0x9894a8-_0x27cd04,_0x5a9a1f,_0x3c75cb),'share':_0x5a9a1f,'money':_0x3c75cb===null||_0x3c75cb===void 0x0?void 0x0:_0x3c75cb[_0x95c645(0x99)]});}}[_0x5454a4(0xde)](_0xbdc6cc,_0x1e1892,_0x52d4ae,_0x163fd4){const _0x2cbaed=_0x5454a4,_0x384344=tinkoff_invest_api_1[_0x2cbaed(0xd3)][_0x2cbaed(0xf3)](_0x52d4ae[_0x2cbaed(0xd8)]);if(_0x52d4ae[_0x2cbaed(0x102)][_0x2cbaed(0xab)](_0x2cbaed(0xdf)))return(0x0,nearest_increment_value_1['nearestHighIncrementValue'])(_0xbdc6cc+_0x1e1892*((_0x163fd4===null||_0x163fd4===void 0x0?void 0x0:_0x163fd4[_0x2cbaed(0xdd)])||this[_0x2cbaed(0x9e)][_0x2cbaed(0xb9)]),_0x384344);return _0xbdc6cc<0x5?(0x0,nearest_increment_value_1[_0x2cbaed(0xd6)])(_0xbdc6cc+_0x384344,_0x384344):(0x0,nearest_increment_value_1[_0x2cbaed(0xd6)])(_0xbdc6cc+_0x1e1892*((_0x163fd4===null||_0x163fd4===void 0x0?void 0x0:_0x163fd4[_0x2cbaed(0xdd)])||this[_0x2cbaed(0x9e)]['foreignDiffSharesBuy']),_0x384344);}[_0x5454a4(0xea)](_0x3f3c76){const _0x3ce09c=_0x5454a4;this[_0x3ce09c(0x9e)]=_0x3f3c76;const _0x46eb76=perf_hooks_1[_0x3ce09c(0xac)][_0x3ce09c(0xed)]();this['api'][_0x3ce09c(0xf9)][_0x3ce09c(0xb8)]({'instrumentStatus':instruments_1['InstrumentStatus'][_0x3ce09c(0xd5)]})[_0x3ce09c(0xf1)](_0x53cf54=>{const _0x105416=_0x3ce09c,_0x4fc23c=perf_hooks_1[_0x105416(0xac)]['now']();console['log'](_0x105416(0x96)+(_0x4fc23c-_0x46eb76)['toFixed'](0x2)+_0x105416(0xba)),console[_0x105416(0x100)](_0x105416(0x97),_0x105416(0x103),'\x1b[37m'),this[_0x105416(0xaf)](_0x53cf54['instruments']);});}}exports[_0x5454a4(0xda)]=DropShares;