'use strict';function _0x19dd(_0x14efde,_0xf3b75d){const _0x2681be=_0x2681();return _0x19dd=function(_0x19dde4,_0x12990e){_0x19dde4=_0x19dde4-0x185;let _0x441b6f=_0x2681be[_0x19dde4];return _0x441b6f;},_0x19dd(_0x14efde,_0xf3b75d);}const _0x252606=_0x19dd;(function(_0x45c411,_0x5490f9){const _0x280702=_0x19dd,_0x5078f9=_0x45c411();while(!![]){try{const _0x588046=parseInt(_0x280702(0x1bf))/0x1+parseInt(_0x280702(0x18c))/0x2*(-parseInt(_0x280702(0x1b3))/0x3)+parseInt(_0x280702(0x1b2))/0x4*(parseInt(_0x280702(0x188))/0x5)+-parseInt(_0x280702(0x1c6))/0x6*(-parseInt(_0x280702(0x18d))/0x7)+parseInt(_0x280702(0x197))/0x8*(-parseInt(_0x280702(0x191))/0x9)+parseInt(_0x280702(0x19f))/0xa*(-parseInt(_0x280702(0x19e))/0xb)+-parseInt(_0x280702(0x196))/0xc;if(_0x588046===_0x5490f9)break;else _0x5078f9['push'](_0x5078f9['shift']());}catch(_0x2a2441){_0x5078f9['push'](_0x5078f9['shift']());}}}(_0x2681,0x70317));function _0x2681(){const _0x519a16=['performance','nearestHighIncrementValue','unsubscribes','buy','__asyncValues','map','\x20мс','moexDiffFuture','1177688bqDiRE','34779qGvIbJ','api','stream\x20closed,\x20reason:','market','error','candles','toFixed','moexDiffFutureBuy','stream\x20error','log','function','halt','881047qXlvlb','figi','defineProperty','filter','instruments','next','getPrice','5345448yxAvKF','length','nano','call','options','tinkoff-invest-api','Время\x20обработки\x20свечи\x20для\x20','toNumber','minPriceIncrement','done','resolve','close','rxjs','15JZUOel','SubscriptionInterval','Symbol.asyncIterator\x20is\x20not\x20defined.','buyTheDrop','152jgAicq','7NOvBHq','perf_hooks','processOnCandle','DropFutures','9gBSYAm','haltTimeout','push','tinkoff-invest-api/cjs/generated/instruments','Subject','4013052LkMHpp','2264504XlIFio','stop','asyncIterator','then','Helpers','now','find','3834193wweQzZ','20BugfWp','iterator','slice','value','createMarketStream','return','INSTRUMENT_STATUS_BASE','InstrumentStatus','stream','units','startFuturesDrop'];_0x2681=function(){return _0x519a16;};return _0x2681();}var __asyncValues=this&&this[_0x252606(0x1ae)]||function(_0x38974d){const _0x4ae50c=_0x252606;if(!Symbol[_0x4ae50c(0x199)])throw new TypeError(_0x4ae50c(0x18a));var _0x5c63f6=_0x38974d[Symbol[_0x4ae50c(0x199)]],_0xa560f1;return _0x5c63f6?_0x5c63f6[_0x4ae50c(0x1c9)](_0x38974d):(_0x38974d=typeof __values===_0x4ae50c(0x1bd)?__values(_0x38974d):_0x38974d[Symbol[_0x4ae50c(0x1a0)]](),_0xa560f1={},_0x81acff(_0x4ae50c(0x1c4)),_0x81acff('throw'),_0x81acff(_0x4ae50c(0x1a4)),_0xa560f1[Symbol[_0x4ae50c(0x199)]]=function(){return this;},_0xa560f1);function _0x81acff(_0x58afe7){_0xa560f1[_0x58afe7]=_0x38974d[_0x58afe7]&&function(_0x4f7a86){return new Promise(function(_0x490bd1,_0x5b0373){const _0x50d934=_0x19dd;_0x4f7a86=_0x38974d[_0x58afe7](_0x4f7a86),_0x1d48d2(_0x490bd1,_0x5b0373,_0x4f7a86['done'],_0x4f7a86[_0x50d934(0x1a2)]);});};}function _0x1d48d2(_0x336083,_0x50abff,_0x282149,_0x1a09bf){const _0x1306d0=_0x4ae50c;Promise[_0x1306d0(0x185)](_0x1a09bf)[_0x1306d0(0x19a)](function(_0x9374ba){_0x336083({'value':_0x9374ba,'done':_0x282149});},_0x50abff);}};Object[_0x252606(0x1c1)](exports,'__esModule',{'value':!![]}),exports[_0x252606(0x190)]=void 0x0;const rxjs_1=require(_0x252606(0x187)),tinkoff_invest_api_1=require(_0x252606(0x1cb)),instruments_1=require(_0x252606(0x194)),marketdata_1=require('tinkoff-invest-api/cjs/generated/marketdata'),nearest_increment_value_1=require('../utils/nearest-increment-value'),perf_hooks_1=require(_0x252606(0x18e)),CHANK_SIZE=0x12c;class DropFutures{constructor(_0x2f3e97,_0xcf44c0){const _0x4f11d1=_0x252606;this[_0x4f11d1(0x1b4)]=_0x2f3e97,this[_0x4f11d1(0x1ca)]=_0xcf44c0,this['buyTheDrop']=new rxjs_1[(_0x4f11d1(0x195))](),this[_0x4f11d1(0x1ac)]=[],this[_0x4f11d1(0x1ad)]=this[_0x4f11d1(0x18b)]['pipe']((0x0,rxjs_1[_0x4f11d1(0x1c2)])(()=>!this[_0x4f11d1(0x1be)]),(0x0,rxjs_1['tap'])(()=>{const _0x5f0918=_0x4f11d1;!this[_0x5f0918(0x1be)]&&(this[_0x5f0918(0x1be)]=!![],setTimeout(()=>this[_0x5f0918(0x1be)]=![],this[_0x5f0918(0x1ca)][_0x5f0918(0x192)]));}));}async[_0x252606(0x1a9)](){const _0x636424=_0x252606;var _0x1bd6b9,_0x5d7002,_0x40ff1b,_0x273cb7;const _0x2ec503=perf_hooks_1[_0x636424(0x1aa)][_0x636424(0x19c)](),_0x21c200=await this['api']['instruments']['futures']({'instrumentStatus':instruments_1[_0x636424(0x1a6)][_0x636424(0x1a5)]}),_0xbe248d=perf_hooks_1[_0x636424(0x1aa)][_0x636424(0x19c)]();console['log']('Время\x20запроса\x20futures:\x20'+(_0xbe248d-_0x2ec503)['toFixed'](0x2)+_0x636424(0x1b0));const _0x899422=[];for(let _0x5261fc=0x0;_0x5261fc<_0x21c200[_0x636424(0x1c3)][_0x636424(0x1c7)];_0x5261fc+=CHANK_SIZE){_0x899422[_0x636424(0x193)](_0x21c200['instruments'][_0x636424(0x1a1)](_0x5261fc,_0x5261fc+CHANK_SIZE));}try{for(var _0x24e044=!![],_0x149477=__asyncValues(_0x899422),_0x2ad3d5;_0x2ad3d5=await _0x149477['next'](),_0x1bd6b9=_0x2ad3d5[_0x636424(0x1cf)],!_0x1bd6b9;){_0x273cb7=_0x2ad3d5[_0x636424(0x1a2)],_0x24e044=![];try{const _0x276d83=_0x273cb7,_0x24b060=await this[_0x636424(0x1b4)][_0x636424(0x1a3)]()[_0x636424(0x1b8)]({'instruments':_0x276d83[_0x636424(0x1af)](_0x5eda9b=>({'figi':_0x5eda9b['figi'],'interval':marketdata_1[_0x636424(0x189)]['SUBSCRIPTION_INTERVAL_ONE_MINUTE']})),'waitingClose':![]},_0x5c9f75=>this[_0x636424(0x18f)](_0x5c9f75,_0x276d83));this[_0x636424(0x1ac)][_0x636424(0x193)](_0x24b060),this[_0x636424(0x1b4)][_0x636424(0x1a7)][_0x636424(0x1b6)]['on'](_0x636424(0x1b7),_0x1603f2=>console['log'](_0x636424(0x1bb),_0x1603f2)),this[_0x636424(0x1b4)]['stream'][_0x636424(0x1b6)]['on'](_0x636424(0x186),_0x34da71=>console[_0x636424(0x1bc)](_0x636424(0x1b5),_0x34da71));}finally{_0x24e044=!![];}}}catch(_0x5bd263){_0x5d7002={'error':_0x5bd263};}finally{try{if(!_0x24e044&&!_0x1bd6b9&&(_0x40ff1b=_0x149477[_0x636424(0x1a4)]))await _0x40ff1b[_0x636424(0x1c9)](_0x149477);}finally{if(_0x5d7002)throw _0x5d7002['error'];}}return this[_0x636424(0x1ad)];}['processOnCandle'](_0x32ada6,_0x357dad){const _0x59345a=_0x252606,{open:_0x49d691,low:_0x2a01e6}=_0x32ada6,_0x5742c1=_0x357dad[_0x59345a(0x19d)](_0xc1aad6=>_0xc1aad6[_0x59345a(0x1c0)]===_0x32ada6[_0x59345a(0x1c0)]),_0x1d09fa=Number(_0x2a01e6[_0x59345a(0x1a8)]+'.'+_0x2a01e6['nano']),_0x584ba7=Number(_0x49d691['units']+'.'+_0x49d691[_0x59345a(0x1c8)]);if(_0x584ba7*this[_0x59345a(0x1ca)][_0x59345a(0x1b1)]>_0x1d09fa){const _0x5b47e9=perf_hooks_1['performance']['now']();this[_0x59345a(0x18b)]['next']({'price':this['getPrice'](_0x1d09fa,_0x584ba7-_0x1d09fa,_0x5742c1),'future':_0x5742c1});const _0x58edc7=perf_hooks_1['performance'][_0x59345a(0x19c)]();console[_0x59345a(0x1bc)](_0x59345a(0x1cc)+_0x5742c1['name']+':\x20'+(_0x58edc7-_0x5b47e9)[_0x59345a(0x1b9)](0x2)+_0x59345a(0x1b0));}}[_0x252606(0x1c5)](_0x2d1764,_0x599a09,_0x52e5e4){const _0x813111=_0x252606;return(0x0,nearest_increment_value_1[_0x813111(0x1ab)])(_0x2d1764+_0x599a09*this[_0x813111(0x1ca)][_0x813111(0x1ba)],tinkoff_invest_api_1[_0x813111(0x19b)][_0x813111(0x1cd)](_0x52e5e4[_0x813111(0x1ce)]));}[_0x252606(0x198)](){const _0xc50c4a=_0x252606;Promise['all'](this[_0xc50c4a(0x1ac)])[_0xc50c4a(0x19a)]();}}exports['DropFutures']=DropFutures;