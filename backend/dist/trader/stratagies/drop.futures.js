'use strict';const _0x58e2ff=_0x322a;(function(_0x5948bd,_0x2b4340){const _0x50c71b=_0x322a,_0x1b347d=_0x5948bd();while(!![]){try{const _0x3616d7=-parseInt(_0x50c71b(0x15f))/0x1+-parseInt(_0x50c71b(0x132))/0x2+parseInt(_0x50c71b(0x151))/0x3*(-parseInt(_0x50c71b(0x148))/0x4)+parseInt(_0x50c71b(0x146))/0x5*(-parseInt(_0x50c71b(0x166))/0x6)+parseInt(_0x50c71b(0x133))/0x7+parseInt(_0x50c71b(0x134))/0x8+parseInt(_0x50c71b(0x170))/0x9;if(_0x3616d7===_0x2b4340)break;else _0x1b347d['push'](_0x1b347d['shift']());}catch(_0x4f1804){_0x1b347d['push'](_0x1b347d['shift']());}}}(_0x4e81,0xece56));function _0x4e81(){const _0x13797d=['3HgVUxK','error','buyTheDrop','SubscriptionInterval','now','toNumber','figi','instruments','find','stream\x20closed,\x20reason:','units','close','__esModule','../utils/nearest-increment-value','256212XyWiaT','call','haltTimeout','done','stop','getPrice','toFixed','18EaNPsn','stream','tap','Subject','minPriceIncrement','iterator','unsubscribes','Время\x20запроса\x20futures:\x20','map','api','22930281JXgpTW','return','value','push','then','moexDiffFutureBuy','tinkoff-invest-api/cjs/generated/marketdata','\x20мс','stream\x20error','INSTRUMENT_STATUS_BASE','candles','2433740GNKmsY','6361663gswIss','8306720HhuPRS','pipe','tinkoff-invest-api/cjs/generated/instruments','nano','halt','DropFutures','defineProperty','options','log','Symbol.asyncIterator\x20is\x20not\x20defined.','InstrumentStatus','asyncIterator','createMarketStream','market','futures','filter','processOnCandle','name','1266665rKEtiX','resolve','5166204LMXHoo','function','slice','performance','buy','Helpers','next','tinkoff-invest-api','nearestHighIncrementValue'];_0x4e81=function(){return _0x13797d;};return _0x4e81();}var __asyncValues=this&&this['__asyncValues']||function(_0x1144a4){const _0x39cb4a=_0x322a;if(!Symbol[_0x39cb4a(0x13f)])throw new TypeError(_0x39cb4a(0x13d));var _0x41c02d=_0x1144a4[Symbol['asyncIterator']],_0x5956c4;return _0x41c02d?_0x41c02d[_0x39cb4a(0x160)](_0x1144a4):(_0x1144a4=typeof __values===_0x39cb4a(0x149)?__values(_0x1144a4):_0x1144a4[Symbol[_0x39cb4a(0x16b)]](),_0x5956c4={},_0x3711da(_0x39cb4a(0x14e)),_0x3711da('throw'),_0x3711da(_0x39cb4a(0x171)),_0x5956c4[Symbol[_0x39cb4a(0x13f)]]=function(){return this;},_0x5956c4);function _0x3711da(_0x2f9514){_0x5956c4[_0x2f9514]=_0x1144a4[_0x2f9514]&&function(_0x45d27a){return new Promise(function(_0x195fd6,_0x49f8d4){const _0x2c4d29=_0x322a;_0x45d27a=_0x1144a4[_0x2f9514](_0x45d27a),_0x4e0636(_0x195fd6,_0x49f8d4,_0x45d27a[_0x2c4d29(0x162)],_0x45d27a['value']);});};}function _0x4e0636(_0x47121a,_0x3427dc,_0x4fc5d0,_0xba43d9){const _0x7a1852=_0x39cb4a;Promise[_0x7a1852(0x147)](_0xba43d9)['then'](function(_0x47ec8b){_0x47121a({'value':_0x47ec8b,'done':_0x4fc5d0});},_0x3427dc);}};function _0x322a(_0x4dd657,_0x3ae393){const _0x4e8151=_0x4e81();return _0x322a=function(_0x322a28,_0x5c40ba){_0x322a28=_0x322a28-0x12a;let _0x4d401b=_0x4e8151[_0x322a28];return _0x4d401b;},_0x322a(_0x4dd657,_0x3ae393);}Object[_0x58e2ff(0x13a)](exports,_0x58e2ff(0x15d),{'value':!![]}),exports[_0x58e2ff(0x139)]=void 0x0;const rxjs_1=require('rxjs'),tinkoff_invest_api_1=require(_0x58e2ff(0x14f)),instruments_1=require(_0x58e2ff(0x136)),marketdata_1=require(_0x58e2ff(0x12d)),nearest_increment_value_1=require(_0x58e2ff(0x15e)),perf_hooks_1=require('perf_hooks'),CHANK_SIZE=0x12c;class DropFutures{constructor(_0x1b41d0,_0x45feca){const _0x130e4f=_0x58e2ff;this[_0x130e4f(0x16f)]=_0x1b41d0,this[_0x130e4f(0x13b)]=_0x45feca,this['buyTheDrop']=new rxjs_1[(_0x130e4f(0x169))](),this[_0x130e4f(0x16c)]=[],this[_0x130e4f(0x14c)]=this[_0x130e4f(0x153)][_0x130e4f(0x135)]((0x0,rxjs_1[_0x130e4f(0x143)])(()=>!this[_0x130e4f(0x138)]),(0x0,rxjs_1[_0x130e4f(0x168)])(()=>{const _0x479042=_0x130e4f;!this[_0x479042(0x138)]&&(this[_0x479042(0x138)]=!![],setTimeout(()=>this[_0x479042(0x138)]=![],this[_0x479042(0x13b)][_0x479042(0x161)]));}));}async['startFuturesDrop'](){const _0x3404a7=_0x58e2ff;var _0x4c2768,_0x3105c1,_0x494a98,_0x4664b5;const _0x14f450=perf_hooks_1['performance'][_0x3404a7(0x155)](),_0x3bc768=await this['api']['instruments'][_0x3404a7(0x142)]({'instrumentStatus':instruments_1[_0x3404a7(0x13e)][_0x3404a7(0x130)]}),_0x35f9ab=perf_hooks_1[_0x3404a7(0x14b)][_0x3404a7(0x155)]();console['log'](_0x3404a7(0x16d)+(_0x35f9ab-_0x14f450)[_0x3404a7(0x165)](0x2)+_0x3404a7(0x12e));const _0x121d06=[];for(let _0x6a6e6f=0x0;_0x6a6e6f<_0x3bc768[_0x3404a7(0x158)]['length'];_0x6a6e6f+=CHANK_SIZE){_0x121d06[_0x3404a7(0x12a)](_0x3bc768[_0x3404a7(0x158)][_0x3404a7(0x14a)](_0x6a6e6f,_0x6a6e6f+CHANK_SIZE));}try{for(var _0x390ae2=!![],_0x1f2cd9=__asyncValues(_0x121d06),_0x3ccdc5;_0x3ccdc5=await _0x1f2cd9[_0x3404a7(0x14e)](),_0x4c2768=_0x3ccdc5[_0x3404a7(0x162)],!_0x4c2768;){_0x4664b5=_0x3ccdc5[_0x3404a7(0x172)],_0x390ae2=![];try{const _0x1e32ca=_0x4664b5,_0x2c6636=await this[_0x3404a7(0x16f)][_0x3404a7(0x140)]()[_0x3404a7(0x131)]({'instruments':_0x1e32ca[_0x3404a7(0x16e)](_0x34d151=>({'figi':_0x34d151[_0x3404a7(0x157)],'interval':marketdata_1[_0x3404a7(0x154)]['SUBSCRIPTION_INTERVAL_ONE_MINUTE']})),'waitingClose':![]},_0x105e20=>this['processOnCandle'](_0x105e20,_0x1e32ca));this[_0x3404a7(0x16c)][_0x3404a7(0x12a)](_0x2c6636),this[_0x3404a7(0x16f)][_0x3404a7(0x167)]['market']['on'](_0x3404a7(0x152),_0x4dbe80=>console[_0x3404a7(0x13c)](_0x3404a7(0x12f),_0x4dbe80)),this[_0x3404a7(0x16f)][_0x3404a7(0x167)][_0x3404a7(0x141)]['on'](_0x3404a7(0x15c),_0x31cd31=>console[_0x3404a7(0x13c)](_0x3404a7(0x15a),_0x31cd31));}finally{_0x390ae2=!![];}}}catch(_0x59b4b3){_0x3105c1={'error':_0x59b4b3};}finally{try{if(!_0x390ae2&&!_0x4c2768&&(_0x494a98=_0x1f2cd9[_0x3404a7(0x171)]))await _0x494a98[_0x3404a7(0x160)](_0x1f2cd9);}finally{if(_0x3105c1)throw _0x3105c1['error'];}}return this['buy'];}[_0x58e2ff(0x144)](_0x27eddd,_0x38aa04){const _0x485f7c=_0x58e2ff,{open:_0x1dd6cc,low:_0x26eb9f}=_0x27eddd,_0x5a07c9=_0x38aa04[_0x485f7c(0x159)](_0x23956c=>_0x23956c[_0x485f7c(0x157)]===_0x27eddd['figi']),_0xdf1d12=Number(_0x26eb9f[_0x485f7c(0x15b)]+'.'+_0x26eb9f[_0x485f7c(0x137)]),_0x379d25=Number(_0x1dd6cc['units']+'.'+_0x1dd6cc[_0x485f7c(0x137)]);if(_0x379d25*this[_0x485f7c(0x13b)]['moexDiffFuture']>_0xdf1d12){const _0x1ef657=perf_hooks_1[_0x485f7c(0x14b)][_0x485f7c(0x155)]();this['buyTheDrop']['next']({'price':this['getPrice'](_0xdf1d12,_0x379d25-_0xdf1d12,_0x5a07c9),'future':_0x5a07c9});const _0x1824f2=perf_hooks_1[_0x485f7c(0x14b)][_0x485f7c(0x155)]();console[_0x485f7c(0x13c)]('Время\x20обработки\x20свечи\x20для\x20'+_0x5a07c9[_0x485f7c(0x145)]+':\x20'+(_0x1824f2-_0x1ef657)[_0x485f7c(0x165)](0x2)+_0x485f7c(0x12e));}}[_0x58e2ff(0x164)](_0x2a4ded,_0x5cd033,_0x52c350){const _0x54a4f4=_0x58e2ff;return(0x0,nearest_increment_value_1[_0x54a4f4(0x150)])(_0x2a4ded+_0x5cd033*this[_0x54a4f4(0x13b)][_0x54a4f4(0x12c)],tinkoff_invest_api_1[_0x54a4f4(0x14d)][_0x54a4f4(0x156)](_0x52c350[_0x54a4f4(0x16a)]));}[_0x58e2ff(0x163)](){const _0x136117=_0x58e2ff;Promise['all'](this[_0x136117(0x16c)])[_0x136117(0x12b)]();}}exports[_0x58e2ff(0x139)]=DropFutures;