'use strict';const _0x367cfa=_0x466e;(function(_0x5bc7b6,_0x3d81a8){const _0x4293ca=_0x466e,_0x4baa23=_0x5bc7b6();while(!![]){try{const _0x52dc47=parseInt(_0x4293ca(0x14e))/0x1+-parseInt(_0x4293ca(0x149))/0x2*(-parseInt(_0x4293ca(0x13f))/0x3)+parseInt(_0x4293ca(0x16d))/0x4+parseInt(_0x4293ca(0x150))/0x5+parseInt(_0x4293ca(0x16b))/0x6*(parseInt(_0x4293ca(0x162))/0x7)+-parseInt(_0x4293ca(0x132))/0x8+parseInt(_0x4293ca(0x161))/0x9*(-parseInt(_0x4293ca(0x166))/0xa);if(_0x52dc47===_0x3d81a8)break;else _0x4baa23['push'](_0x4baa23['shift']());}catch(_0x272de3){_0x4baa23['push'](_0x4baa23['shift']());}}}(_0x26d5,0x4db7b));var __asyncValues=this&&this[_0x367cfa(0x148)]||function(_0x13ee9e){const _0x21afd1=_0x367cfa;if(!Symbol[_0x21afd1(0x133)])throw new TypeError(_0x21afd1(0x143));var _0x31602e=_0x13ee9e[Symbol[_0x21afd1(0x133)]],_0x146c97;return _0x31602e?_0x31602e[_0x21afd1(0x135)](_0x13ee9e):(_0x13ee9e=typeof __values===_0x21afd1(0x155)?__values(_0x13ee9e):_0x13ee9e[Symbol[_0x21afd1(0x12a)]](),_0x146c97={},_0x50acec(_0x21afd1(0x16a)),_0x50acec(_0x21afd1(0x14c)),_0x50acec(_0x21afd1(0x136)),_0x146c97[Symbol[_0x21afd1(0x133)]]=function(){return this;},_0x146c97);function _0x50acec(_0x21542b){_0x146c97[_0x21542b]=_0x13ee9e[_0x21542b]&&function(_0x24b225){return new Promise(function(_0x453085,_0x37e37f){const _0x3e39f4=_0x466e;_0x24b225=_0x13ee9e[_0x21542b](_0x24b225),_0xd87710(_0x453085,_0x37e37f,_0x24b225['done'],_0x24b225[_0x3e39f4(0x15f)]);});};}function _0xd87710(_0x34d78d,_0x59c04a,_0x6e795b,_0x2d1ffe){const _0x97687a=_0x21afd1;Promise['resolve'](_0x2d1ffe)[_0x97687a(0x15c)](function(_0x3055ba){_0x34d78d({'value':_0x3055ba,'done':_0x6e795b});},_0x59c04a);}};function _0x466e(_0x2770e3,_0x4cf3d9){const _0x26d580=_0x26d5();return _0x466e=function(_0x466ebd,_0x5d8ee9){_0x466ebd=_0x466ebd-0x126;let _0x41408e=_0x26d580[_0x466ebd];return _0x41408e;},_0x466e(_0x2770e3,_0x4cf3d9);}function _0x26d5(){const _0xe4a69=['stream','nano','Symbol.asyncIterator\x20is\x20not\x20defined.','push','getPrice','log','moexDiffFuture','__asyncValues','1148990fajjMm','haltTimeout','halt','throw','candles','8750YIqZXd','figi','419505ZnYhaf','DropFutures','__esModule','units','error','function','nearestHighIncrementValue','options','toNumber','SUBSCRIPTION_INTERVAL_ONE_MINUTE','stream\x20error','close','then','rxjs','buy','value','performance','1592928dXagIB','1220569PhydoT','InstrumentStatus','slice','futures','30BgMPWv','unsubscribes','\x20мс','buyTheDrop','next','12jzECJs','startFuturesDrop','918240DYYDhB','find','stream\x20closed,\x20reason:','INSTRUMENT_STATUS_BASE','SubscriptionInterval','iterator','api','Helpers','length','stop','../utils/nearest-increment-value','instruments','Subject','3169064mbbkId','asyncIterator','all','call','return','moexDiffFutureBuy','now','tap','processOnCandle','defineProperty','toFixed','pipe','map','3rfBoiQ','name'];_0x26d5=function(){return _0xe4a69;};return _0x26d5();}Object[_0x367cfa(0x13b)](exports,_0x367cfa(0x152),{'value':!![]}),exports['DropFutures']=void 0x0;const rxjs_1=require(_0x367cfa(0x15d)),tinkoff_invest_api_1=require('tinkoff-invest-api'),instruments_1=require('tinkoff-invest-api/cjs/generated/instruments'),marketdata_1=require('tinkoff-invest-api/cjs/generated/marketdata'),nearest_increment_value_1=require(_0x367cfa(0x12f)),perf_hooks_1=require('perf_hooks'),CHANK_SIZE=0x12c;class DropFutures{constructor(_0x38265e,_0x3b1abc){const _0x219d38=_0x367cfa;this['api']=_0x38265e,this[_0x219d38(0x157)]=_0x3b1abc,this[_0x219d38(0x169)]=new rxjs_1[(_0x219d38(0x131))](),this[_0x219d38(0x167)]=[],this['buy']=this[_0x219d38(0x169)][_0x219d38(0x13d)]((0x0,rxjs_1['filter'])(()=>!this[_0x219d38(0x14b)]),(0x0,rxjs_1[_0x219d38(0x139)])(()=>{const _0x2e64c1=_0x219d38;!this[_0x2e64c1(0x14b)]&&(this['halt']=!![],setTimeout(()=>this[_0x2e64c1(0x14b)]=![],this[_0x2e64c1(0x157)][_0x2e64c1(0x14a)]));}));}async[_0x367cfa(0x16c)](){const _0x35cef6=_0x367cfa;var _0x55f579,_0xa79086;const _0x1ad4b2=perf_hooks_1[_0x35cef6(0x160)][_0x35cef6(0x138)](),_0x388de7=await this[_0x35cef6(0x12b)]['instruments'][_0x35cef6(0x165)]({'instrumentStatus':instruments_1[_0x35cef6(0x163)][_0x35cef6(0x128)]}),_0x3da017=perf_hooks_1[_0x35cef6(0x160)]['now']();console[_0x35cef6(0x146)]('Время\x20запроса\x20futures:\x20'+(_0x3da017-_0x1ad4b2)['toFixed'](0x2)+_0x35cef6(0x168));const _0x42750a=[];for(let _0x3b716a=0x0;_0x3b716a<_0x388de7[_0x35cef6(0x130)][_0x35cef6(0x12d)];_0x3b716a+=CHANK_SIZE){_0x42750a[_0x35cef6(0x144)](_0x388de7['instruments'][_0x35cef6(0x164)](_0x3b716a,_0x3b716a+CHANK_SIZE));}try{for(var _0x3f1964=__asyncValues(_0x42750a),_0x1209b3;_0x1209b3=await _0x3f1964['next'](),!_0x1209b3['done'];){const _0xd0db04=_0x1209b3[_0x35cef6(0x15f)],_0x41c79e=await this[_0x35cef6(0x12b)]['createMarketStream']()[_0x35cef6(0x14d)]({'instruments':_0xd0db04[_0x35cef6(0x13e)](_0x1f733d=>({'figi':_0x1f733d[_0x35cef6(0x14f)],'interval':marketdata_1[_0x35cef6(0x129)][_0x35cef6(0x159)]})),'waitingClose':![]},_0x29d375=>this[_0x35cef6(0x13a)](_0x29d375,_0xd0db04));this[_0x35cef6(0x167)][_0x35cef6(0x144)](_0x41c79e),this[_0x35cef6(0x12b)][_0x35cef6(0x141)]['market']['on'](_0x35cef6(0x154),_0x12a243=>console[_0x35cef6(0x146)](_0x35cef6(0x15a),_0x12a243)),this['api'][_0x35cef6(0x141)]['market']['on'](_0x35cef6(0x15b),_0x4646b7=>console['log'](_0x35cef6(0x127),_0x4646b7));}}catch(_0x5d6110){_0x55f579={'error':_0x5d6110};}finally{try{if(_0x1209b3&&!_0x1209b3['done']&&(_0xa79086=_0x3f1964['return']))await _0xa79086['call'](_0x3f1964);}finally{if(_0x55f579)throw _0x55f579[_0x35cef6(0x154)];}}return this[_0x35cef6(0x15e)];}[_0x367cfa(0x13a)](_0xf22d38,_0x40d364){const _0x43863c=_0x367cfa,{open:_0x309b07,low:_0x1c8d4f}=_0xf22d38,_0x5819a5=_0x40d364[_0x43863c(0x126)](_0x5772fb=>_0x5772fb[_0x43863c(0x14f)]===_0xf22d38['figi']),_0x23fbea=Number(_0x1c8d4f[_0x43863c(0x153)]+'.'+_0x1c8d4f[_0x43863c(0x142)]),_0xf9ff3=Number(_0x309b07[_0x43863c(0x153)]+'.'+_0x309b07['nano']);if(_0xf9ff3*this[_0x43863c(0x157)][_0x43863c(0x147)]>_0x23fbea){const _0x12af94=perf_hooks_1['performance']['now']();this[_0x43863c(0x169)][_0x43863c(0x16a)]({'price':this[_0x43863c(0x145)](_0x23fbea,_0xf9ff3-_0x23fbea,_0x5819a5),'future':_0x5819a5});const _0x50c07a=perf_hooks_1[_0x43863c(0x160)][_0x43863c(0x138)]();console[_0x43863c(0x146)]('Время\x20обработки\x20свечи\x20для\x20'+_0x5819a5[_0x43863c(0x140)]+':\x20'+(_0x50c07a-_0x12af94)[_0x43863c(0x13c)](0x2)+_0x43863c(0x168));}}['getPrice'](_0x5af8be,_0x89818,_0xca6dbc){const _0x5311c9=_0x367cfa;return(0x0,nearest_increment_value_1[_0x5311c9(0x156)])(_0x5af8be+_0x89818*this[_0x5311c9(0x157)][_0x5311c9(0x137)],tinkoff_invest_api_1[_0x5311c9(0x12c)][_0x5311c9(0x158)](_0xca6dbc['minPriceIncrement']));}[_0x367cfa(0x12e)](){const _0x2cee9b=_0x367cfa;Promise[_0x2cee9b(0x134)](this[_0x2cee9b(0x167)])['then']();}}exports[_0x367cfa(0x151)]=DropFutures;